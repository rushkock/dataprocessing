<!--Name: Ruchella Kock-->
<!--Student number: 12460796-->
<!DOCTYPE html>
<html>
<head>
  <title>Line Graph</title>
</head>

<body>
  <canvas id="myCanvas" width="900" height="500"
  style="border:1px solid #d3d3d3;">
  </canvas>
</body>

<script>
  // read the json file into a HTTP request
  var fileName = "crime.json";
  var txtFile = new XMLHttpRequest();
  txtFile.onreadystatechange = function()
  {
    if (txtFile.readyState === 4 && txtFile.status == 200)
    {
      var data =  JSON.parse(txtFile.responseText);
      var keys = [];
      var values = [];
      // go over every value in data and get the key, append to array
      for (var key in data)
      {
        // go over everything inside of the key, append to array
        for (var dt in data[key])
        {
          values.push(data[key].Rape);
        }
        keys.push(parseInt(key));
      }

      // this function gets the min and max value of an array and returns an array
      function minMax(array)
      {
        array.sort(function(a, b){return a-b});
        min = array[0];
        max = array[array.length-1];
        return [min,max];
      }
      var canvas = document.getElementById("myCanvas");

      // get the range and domain for the createTransform function
      var rangeX = [0, canvas.width];
      var rangeY = [0, canvas.height];
      var xAxes = minMax(keys);
      var yAxes = minMax(values);

      // extend the ranges
      yAxes[0] = 70000;
      yAxes[1] = 105000;
      xAxes[0] = xAxes[0] - 1.5;
      xAxes[1] = xAxes[1] + 1;

      // make a function that will calculate the x and y coordinates
      var x = createTransform(xAxes, rangeX);
      var y = createTransform(yAxes, rangeY);

      // get the canvas from HTML
      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext("2d");


      // write text on the x axis
      for (key in data)
      {
        xRape = x(parseInt(key));
        ctx.font = "15px Comic Sans MS";
        ctx.fillText(key, xRape, canvas.height - 20);
      }

      // write x xlabel
      ctx.fillText("Year", canvas.width/2, canvas.height - 5)


      // draw a line for the y axis
      ctx.beginPath();
      ctx.strokeStyle="blue";
      ctx.moveTo(0 + 55, canvas.height - 0);
      ctx.lineTo(0 + 55, canvas.height - 45);
      ctx.lineTo(0 + 40, canvas.height - 50);
      ctx.lineTo(0 + 65, canvas.height - 60);
      ctx.lineTo(0 + 55, canvas.height - 70);
      ctx.lineTo(0 + 55, 0);
      ctx.stroke();

      // write text for y axis
      var steps = 2500;
      for (var i = yAxes[0]; i <= 100000; i += steps)
      {
        var ytext = y(i);
        ctx.strokeStyle="grey";
        ctx.font = "15px Comic Sans MS";
        ctx.textAlign="start";
        if (i === yAxes[0] + steps)
        {
          ctx.fillText(0, 0, canvas.height- ytext);
        }
        else if (i != yAxes[0])
        {
          ctx.fillText(parseInt(i), 0, canvas.height- ytext);
        }
        ctx.beginPath();
        ctx.moveTo(0, canvas.height - ytext);
        ctx.lineTo(xAxes[1], canvas.height - ytext);
        ctx.stroke();
      }

      // go over every value in data
      ctx.beginPath();
      for (var key in data)
      {
        ctx.strokeStyle="red";

        // use the function to calculate the x and y coordinates
        var xRape = x(parseInt(key));
        var yRape = y(data[key].Rape);

        // draw a line to the next value and move to that value
        ctx.lineTo(xRape, canvas.height-yRape);
        ctx.moveTo(xRape, canvas.height-yRape);

        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
        ctx.stroke();
      }

      for (var key in data)
      {
        var xRape = x(parseInt(key));
        var yRape = y(data[key].Rape);
        // draw dots at every value
        ctx.beginPath();
        ctx.strokeStyle="black";
        ctx.lineWidth = 7;
        ctx.lineTo(xRape, canvas.height-yRape);
        ctx.moveTo(xRape, canvas.height-yRape);
        ctx.stroke();
      }
      // write the title
      ctx.font = "30px Comic Sans MS";
      ctx.fillText("Rape victims in the United States per 100,000 Inhabitants", 55 ,50);
    }
  }
  txtFile.open("GET", fileName);
  txtFile.send();

  function createTransform(domain, range)
  {
	// domain is a two-element array of the data bounds [domainMin, domainMax]
	// range is a two-element array of the screen bounds [rangeMin, rangeMax]
	// this gives you two equations to solve:
	// rangeMin = alpha * domainMin + beta
	// rangeMax = alpha * domainMax + beta
 		// a solution would be:

    var domainMin = domain[0];
    var domainMax = domain[1];
    var rangeMin = range[0];
    var rangeMax = range[1];

    // formulas to calculate the alpha and the beta
   	var alpha = (rangeMax - rangeMin) / (domainMax - domainMin);
    var beta = rangeMax - alpha * domainMax;

    // returns the function for the linear transformation (y= a * x + b)
    return function(x)
    {
      return alpha * x + beta;
    }
  }
</script>
</html>
